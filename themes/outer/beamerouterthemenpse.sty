% ====================================================================
%
% Copyleft 2016-today NullaPoliticaSineEthica
%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\ProvidesPackage{beamerouterthemenpse}

\RequirePackage{tikz}

\ifnpse@dark%
  \def\npse@coverimage{npse-cover-dark}
  \def\npse@coverbackgroundimage{defaultbackground-dark.jpg}
  \def\npse@backgroundimage{npse-bg-dark}
\else%
  \def\npse@coverimage{npse-cover-light}
  \def\npse@coverbackgroundimage{defaultbackground-light.jpg}
  \def\npse@backgroundimage{npse-bg-light}
\fi%

\DeclareOptionBeamer{coverbackgroundimage}{\def\npse@coverbackgroundimage{#1}}

\def\npse@clientimage{}
\DeclareOptionBeamer{clientimage}{\def\npse@clientimage{#1}}

\ProcessOptionsBeamer


\mode<presentation>


\pgfdeclareimage[interpolate=true, height=\the\paperheight, width=\the\paperwidth]{coverBackgroundImage}{\npse@coverbackgroundimage}

\pgfdeclareimage[interpolate=true, height=\the\paperheight, width=\the\paperwidth]{coverImage}{\npse@coverimage}

\pgfdeclareimage[interpolate=true, height=\the\paperheight, width=\the\paperwidth]{backgroundImage}{\npse@backgroundimage}

\if\npse@clientimage\@empty\else%
\pgfdeclareimage[interpolate=true, width=1.5cm]{clientImage}{\npse@clientimage}
\fi%

% -------------------------------------------------------------------------------
% Title page

\setbeamertemplate{title page} {

  \vskip-1pt

  \hbox{\hskip-\Gm@lmargin
    \begin{tikzpicture}
	  \useasboundingbox (0,0) rectangle (\the\paperwidth, \the\paperheight) ; 
	  \pgftext[at=\pgfpoint{0cm}{0cm},left,base]{\pgfuseimage{coverBackgroundImage}} ; 
    \end{tikzpicture}
  }
    
  \vskip-1\paperheight

  \hbox{\hskip-\Gm@lmargin
    \begin{tikzpicture}
	  \useasboundingbox (0,0) rectangle (\the\paperwidth, \the\paperheight) ; 
	  \pgftext[at=\pgfpoint{0cm}{0cm},left,base]{\pgfuseimage{coverImage}} ; 
    \end{tikzpicture}
  }  

  \vskip-1\paperheight

  % Title
  \usebeamercolor[fg]{title in cover}
  \hbox{\hskip-.01\paperwidth
    \vbox{
      \vskip.1\paperheight
      \usebeamerfont{title}\inserttitle\par
    }
  }

  \usebeamercolor[fg]{frametitle}
  % The optional subtitle
  \ifx\insertsubtitle\vskip0pt plus 1filll\else%
  \hbox{\hskip-.01\paperwidth
    \vbox{
      \vskip.055\paperheight
      \usebeamerfont{subtitle}\insertsubtitle\par
    }
  }
  \fi

  \vskip.59\paperheight

  % Author
  \ifx\insertauthor\@empty\else%
  \hbox{\hskip-.01\paperwidth
    \vbox{
      \usebeamerfont{author}\insertauthor\par
    }
  }
  \fi

  % Institution
  \ifx\insertinstitute\@empty\else%
  \hbox{\hskip-.01\paperwidth
    \vbox{
      \vskip.04\paperheight
      \usebeamerfont{institute}\insertinstitute\par
    }
  }
  \fi

  \vskip0pt plus 1filll
}

% -------------------------------------------------------------------------------
% Page background

\setbeamertemplate{background}{
  \begin{tikzpicture}
	\useasboundingbox (0,0) rectangle (\the\paperwidth, \the\paperheight) ; 
	\pgftext[at=\pgfpoint{0cm}{0cm},left,base]{\pgfuseimage{backgroundImage}} ;

    % Licensed to client
    \ifx\npse@clientimage\@empty\else%
      \pgftext[at=\pgfpoint{11cm}{.7cm},left,base]{\pgfuseimage{clientImage}} ;
    \fi

  \end{tikzpicture}
}

% -------------------------------------------------------------------------------
% Navigation symbols

\setbeamertemplate{navigation symbols}{}

% -------------------------------------------------------------------------------
% Footline

\defbeamertemplate*{footline}{infolines theme}
{
  \leavevmode%
  \hbox{%
  \begin{beamercolorbox}[wd=.33\paperwidth,ht=2.25ex,dp=1ex,center]{section in footer}%
    \inserttitle
  \end{beamercolorbox}%
  \begin{beamercolorbox}[wd=.34\paperwidth,ht=2.25ex,dp=1ex,center]{subsection in footer}%
    \insertsectionhead
  \end{beamercolorbox}%
  \begin{beamercolorbox}[wd=.34\paperwidth,ht=2.25ex,dp=1ex,center]{pagenumber in footer}%
   \insertframenumber{} / \inserttotalframenumber\hspace*{2ex}
  \end{beamercolorbox}}%
  \vskip0pt%
}
